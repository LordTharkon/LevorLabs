<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Candle Calculator & Recipe Builder | LevorLabs</title>
    <meta name="description" content="Free batch calculator for candle makers. Calculate fragrance oil ratios, total wax weights, and container counts for Soy, Paraffin, and Coconut waxes.">
    <meta name="keywords" content="candle calculator, fragrance load formula, soy wax calculator, batch size calculator, LevorLabs">
    
    <meta property="og:title" content="LevorLabs - Candle Batch Calculator">
    <meta property="og:description" content="Stop guessing. Calculate exact wax and fragrance weights for any container size.">
    <meta property="og:image" content="https://levorlabs.com/social-preview.jpg">
    <meta property="og:url" content="https://levorlabs.com/candle/index.html">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYD8L47014"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DYD8L47014');
</script>
<body>

<div class="container">
<header>
    <a href="./index.html" class="brand">
        <i class="ph-fill ph-flame"></i>
        <div class="brand-name">Levor<span style="font-weight:400; opacity: 0.7;">Labs</span></div>
        </a>

	<button class="global-unit-btn" onclick="toggleGlobalUnit()">
    <i class="ph-bold ph-arrows-left-right"></i>
    <span id="global-unit-label">OZ / IN</span>
</button>

    <div class="mobile-toggle" onclick="toggleMenu()">
        <i class="ph ph-list"></i>
    </div>

    <nav class="nav-menu">
        <a href="index.html" class="nav-link active">
            <i class="ph ph-flask"></i> Calculator
        </a>
        
        <a href="wick.html" class="nav-link">
            <i class="ph ph-fire"></i> Wick Finder
        </a>

        <a href="burn.html" class="nav-link">
            <i class="ph ph-timer"></i> Burn Rate
        </a>

        <a href="guide.html" class="nav-link">
            <i class="ph ph-book-open"></i> Wax Guide
        </a>
		
		<a href="label.html" class="nav-link">
            <i class="ph ph-tag"></i> Label Creator
        </a>

		</nav>
</header>

<div class="page-header">
    <h1>Candle Calculator</h1>
    <p>Calculate fragrance ratios and total wax weight for your container size.</p>
</div>

    <div class="main-grid">
        <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <h2 style="margin-bottom:0;"><i class="ph ph-flask"></i> Formulation</h2>
    
    <button class="global-unit-btn mobile-unit-btn" onclick="toggleGlobalUnit()">
        <i class="ph-bold ph-arrows-left-right"></i>
        <span class="mobile-unit-text">OZ / IN</span>
    </button>
</div>
	<div class="form-group">
        <div class="custom-dropdown" id="waxDropdown">
    
    <div class="filter-section">
        <div class="filter-group">
            <span class="filter-label">Region:</span>
			<div class="filter-options" id="regionFilters">
                <button class="filter-chip active" data-filter="all">All</button>
                <button class="filter-chip" data-filter="USA">USA</button>
                <button class="filter-chip" data-filter="Australia">AUS</button>
                <button class="filter-chip" data-filter="Europe">Europe</button>
            </div>
        </div>

        <div class="filter-group" style="margin-top:8px;">
            <span class="filter-label">Type:</span>
            <div class="filter-options" id="typeFilters">
                <button class="filter-chip active" data-filter="all">All</button>
                <button class="filter-chip" data-filter="Soy">Soy</button>
                <button class="filter-chip" data-filter="Paraffin">Paraffin</button>
                <button class="filter-chip" data-filter="Coco">Coconut</button>
            </div>
        </div>
    </div>

    <div class="dropdown-input-wrapper">
        <i class="ph ph-magnifying-glass input-icon"></i>
        <input type="text" id="waxSearchInput" placeholder="Search wax (e.g. 464)..." autocomplete="off">
        <i class="ph ph-caret-down input-arrow"></i>
    </div>

    <div class="dropdown-menu hidden" id="waxOptionsList"></div>
    <input type="hidden" id="waxSelector" value="">
</div>
    </div>
			

            <div id="customSgContainer" class="form-group hidden">
                <label for="customSg">Specific Gravity (from Bag/SDS)</label>
                <input type="number" id="customSg" value="0.86" step="0.01">
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Container Size (Water <span class="unit-label">oz</span>)</label>
                    <input type="number" id="waterWeight" placeholder="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Candle Count</label>
                    <input type="number" id="candleCount" value="1" step="1">
                </div>
            </div>

            <div class="slider-container">
                <div class="slider-header">
                    <label style="margin:0;">Fragrance Load</label>
                    <span id="foDisplay" class="highlight-text">6%</span>
                </div>
                <input type="range" id="foSlider" min="0" max="15" value="6" step="0.5">
                <div class="slider-labels">
                    <span>0%</span>
                    <span>Light (6%)</span>
                    <span>Strong (10%)</span>
                    <span>Max (12%+)</span>
                </div>
            </div>
        </div>

        <div class="card results-panel">
            <div>
                <div class="total-section">
                    <div class="total-label">Total Batch Weight</div>
                    <div class="total-weight"><span id="totalWeightDisplay">0</span><span class="unit unit-label">oz</span></div>
                </div>
                
                <div class="breakdown-row">
    <span>Wax Needed</span>
    <span class="value"><span id="waxNeededDisplay">0</span> <small class="unit-label" style="font-size:0.9rem; font-weight:400; color:#9CA3AF;">oz</small></span>
</div>

<div class="breakdown-row" style="border-bottom: none;">
    <span>Fragrance Oil</span>
    <span class="value" style="color: var(--primary);"><span id="foNeededDisplay">0</span> <small class="unit-label" style="font-size:0.9rem; font-weight:400; color:#9CA3AF;">oz</small></span>
</div>
            </div>

            <div class="disclaimer">
                <i class="ph ph-info" style="vertical-align: middle; margin-right:4px;"></i> 
                Calculated using <span id="currentSgDisplay" style="font-weight:600;">0.86</span> hot Solid Gravity density adjustment for <span id="currentWaxName" style="font-weight:600;">Soy Wax</span>. 
            </div>
        </div>
    </div>

    <div class="info-grid">
        <div class="card info-card">
            <h3><i class="ph ph-thermometer-hot"></i> Melt Point</h3>
            <p id="meltPointInfo">Always add fragrance at 185°F for most soy waxes to ensure proper binding.</p>
        </div>
        <div class="card info-card">
            <h3><i class="ph ph-timer"></i> Cure Time</h3>
            <p id="cureTimeInfo">Soy wax typically requires 2 weeks of curing for optimal hot throw performance.</p>
        </div>
        <div class="card info-card">
            <h3><i class="ph ph-lightbulb"></i> Wick Tip</h3>
            <p>If your flame flickers excessively, your wick might be too large or not trimmed to 1/4".</p>
        </div>
    </div>
</div>

<script src="scripts.js"></script>

<script type="module">
    // 1. IMPORT DATABASE
    import { waxDatabase } from './waxes.js'; 

    // --- ELEMENT REFERENCES ---
    
    // Dropdown specific elements
    const dd = {
        container: document.getElementById('waxDropdown'),
        search: document.getElementById('waxSearchInput'),
        list: document.getElementById('waxOptionsList'),
        hiddenInput: document.getElementById('waxSelector'),
		icon: document.querySelector('.input-arrow')
    };
	
	// --- HELPER: ICON TOGGLER ---
    function setDropdownIcon(state) {
        // State can be 'close' (X) or 'open' (Arrow)
        if (state === 'close') {
            dd.icon.classList.remove('ph-caret-down');
            dd.icon.classList.add('ph-x');
        } else {
            dd.icon.classList.remove('ph-x');
            dd.icon.classList.add('ph-caret-down');
        }
    }

    // Calculator inputs
    const refs = {
        waterWeight: document.getElementById('waterWeight'),
        candleCount: document.getElementById('candleCount'),
        foSlider: document.getElementById('foSlider'),
        customSg: document.getElementById('customSg'),
        customSgContainer: document.getElementById('customSgContainer')
    };

    // Display outputs
    const displays = {
        fo: document.getElementById('foDisplay'),
        total: document.getElementById('totalWeightDisplay'),
        wax: document.getElementById('waxNeededDisplay'),
        foNeed: document.getElementById('foNeededDisplay'),
        sg: document.getElementById('currentSgDisplay'),
        waxName: document.getElementById('currentWaxName'),
        meltInfo: document.getElementById('meltPointInfo'),
        cureInfo: document.getElementById('cureTimeInfo')
    };

    // --- HELPER: TEXT TEMPERATURE CONVERTER ---
    function formatTemp(tempObj) {
        if (!tempObj) return "N/A";
        return `${tempObj.f}°F (${tempObj.c}°C)`;
    }

    // --- PART 1: DROPDOWN LOGIC ---
	
	const activeFilters = {
        region: 'all',
        type: 'all'
    };

// --- REGION MAPPING CONFIGURATION ---
    // Maps your filter buttons to the specific 'origin' strings in waxes.js
    const regionGroups = {
    // USA button shows only 'USA' tagged items (plus 'Global' items by default)
    
    // Europe button shows UK and EU items
    'Europe': ['UK', 'Germany/EU', 'EU', 'UK/USA', 'Germany/SA', 'UK/EU'],
    
    // Australia button shows Australian items AND UK items (Common Imports)
    'Australia': ['Australia', 'UK'], 
    
    'Asia': ['China', 'Japan', 'China/Korea', 'Philippines'],
    'South America': ['Brazil', 'Colombia'],
    'Africa': ['South Africa', 'Africa']
};

    function renderDropdown(filterText = '') {
        dd.list.innerHTML = '';
        const term = filterText.toLowerCase();

        // MASTER FILTER LOGIC
        const matches = waxDatabase.filter(w => {
            // 1. Text Search
            const matchesText = w.name.toLowerCase().includes(term) || 
                                (w.manufacturer && w.manufacturer.toLowerCase().includes(term));
            
            // 2. Region Filter (Updated)
            let matchesRegion = false;
            
            if (activeFilters.region === 'all') {
                matchesRegion = true;
            } 
            else if (w.origin === 'Global') {
                // RULE: Global items (like Stearic Acid) show on EVERY filter
                matchesRegion = true;
            }
            else if (w.origin === activeFilters.region) {
                // Direct match (e.g. "USA" === "USA")
                matchesRegion = true;
            }
            else if (regionGroups[activeFilters.region] && regionGroups[activeFilters.region].includes(w.origin)) {
                // Group match (e.g. "Europe" matches "UK" or "Germany")
                matchesRegion = true;
            }

            // 3. Type Filter (Smart Check)
            const matchesType = activeFilters.type === 'all' || 
                                w.type.toLowerCase().includes(activeFilters.type.toLowerCase());

            return matchesText && matchesRegion && matchesType;
        });

        // --- SORT ALPHABETICALLY ---
        matches.sort((a, b) => a.name.localeCompare(b.name));
        // -

        // RENDER ITEMS
        if (matches.length > 0) {
            matches.forEach(wax => {
                const el = document.createElement('div');
                el.className = 'dropdown-item';
                // UPDATED: Removed the (${wax.origin}) text span below for a cleaner look
                el.innerHTML = `
                    <div class="item-name">${wax.name}</div>
                    <div class="item-meta">
                        <span>${wax.manufacturer || '-'}</span>
                        <span class="type-badge">${wax.type}</span>
                    </div>
                `;
                el.addEventListener('click', () => selectWax(wax));
                dd.list.appendChild(el);
            });
        } else {
            const empty = document.createElement('div');
            empty.className = 'dropdown-item';
            empty.style.color = '#999';
            empty.style.cursor = 'default';
            empty.innerText = 'No waxes found matching filters.';
            dd.list.appendChild(empty);
        }

        // Always show Custom Option
        const customEl = document.createElement('div');
        customEl.className = 'dropdown-item';
        customEl.style.borderTop = '2px solid #f3f4f6';
        customEl.innerHTML = `<div class="item-name">Custom Wax</div><div class="item-meta"><span>Enter SG manually</span></div>`;
        customEl.addEventListener('click', () => selectWax({id: 'custom', name: 'Custom Wax'}));
        dd.list.appendChild(customEl);
    }

    // --- SETUP FILTER LISTENERS ---
    
    function setupFilters(groupId, filterKey) {
        const container = document.getElementById(groupId);
        const buttons = container.querySelectorAll('.filter-chip');

        buttons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                // 1. Visual Toggle
                buttons.forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');

                // 2. Update State
                activeFilters[filterKey] = e.target.dataset.filter;

                // 3. Re-render list (and show it if hidden)
                dd.list.classList.remove('hidden');
                renderDropdown(dd.search.value);
            });
        });
    }

    // Initialize listeners
    setupFilters('regionFilters', 'region');
    setupFilters('typeFilters', 'type');

    function selectWax(wax) {
        // Update UI
        dd.search.value = wax.name;
        dd.hiddenInput.value = wax.id; // Store ID for calculator
        dd.list.classList.add('hidden'); // Close menu
		setDropdownIcon('close');
        
        // Trigger Calc immediately
        calculate();
    }

// --- HANDLE THE CLICK ON THE ICON ---
    dd.icon.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent bubbling issues

        if (dd.icon.classList.contains('ph-x')) {
            // ACTION: CLEAR
            dd.search.value = '';            // 1. Wipe text
            dd.hiddenInput.value = '';       // 2. Wipe data
            setDropdownIcon('open');         // 3. Reset icon
            renderDropdown();                // 4. Show full list (no filter)
            dd.list.classList.remove('hidden'); // 5. Open menu
            calculate();                     // 6. Reset calc numbers
            
            // PRO TIP: We do NOT focus() here. This keeps the mobile keyboard closed
            // so the user can just tap a new wax from the list!
        } else {
            // ACTION: TOGGLE MENU
            // If menu is hidden, show it. If open, hide it.
            if (dd.list.classList.contains('hidden')) {
                renderDropdown(dd.search.value);
                dd.list.classList.remove('hidden');
            } else {
                dd.list.classList.add('hidden');
            }
        }
    });

    // --- PART 2: CALCULATOR LOGIC ---

    function calculate() {
        // 1. Get Inputs
        const waterWeight = parseFloat(refs.waterWeight.value) || 0;
        const count = parseFloat(refs.candleCount.value) || 0;
        const fragranceLoad = parseFloat(refs.foSlider.value) || 0;
        
        // 2. Identify Wax
        const selectedId = dd.hiddenInput.value;
        const selectedWax = waxDatabase.find(w => w.id === selectedId);
        
        // 3. Set Defaults
        let sg = 0.86; 
        let meltMsg = "Check manufacturer instructions.";
        let cureMsg = "Check manufacturer instructions.";
        let waxName = "Custom Wax";

        if (selectedWax) {
            // It is a database wax
            refs.customSgContainer.classList.add('hidden');
            
            // Auto-detect SG based on type if not explicitly in DB
            if(selectedWax.type.includes('Paraffin')) sg = 0.92;
            else if(selectedWax.type.includes('Coco')) sg = 0.88; 
            else sg = 0.86; // Soy default

            waxName = selectedWax.name;
            if(selectedWax.meta) {
                meltMsg = `Heat to ${formatTemp(selectedWax.meta.heatTo)}. Pour at ${formatTemp(selectedWax.meta.pourAt)}.`;
                cureMsg = `Cure time: ${selectedWax.meta.cureTime}.`;
            }
            
        } else if (selectedId === 'custom') {
            // It is Custom Mode
            refs.customSgContainer.classList.remove('hidden');
            sg = parseFloat(refs.customSg.value) || 0.86;
        }

        // 4. Do The Math
        const totalBatchWeight = waterWeight * sg * count;
        const waxWeight = totalBatchWeight / (1 + (fragranceLoad / 100));
        const foWeight = totalBatchWeight - waxWeight;

        // 5. Update Display
        // Check globalUnit variable (from scripts.js)
        const isMetric = (typeof globalUnit !== 'undefined' && globalUnit === 'metric');
        const decimals = isMetric ? 1 : 2;
        
        displays.fo.textContent = fragranceLoad + "%";
        displays.total.textContent = totalBatchWeight.toFixed(decimals);
        displays.wax.textContent = waxWeight.toFixed(decimals);
        displays.foNeed.textContent = foWeight.toFixed(decimals);
        
        displays.sg.textContent = sg;
        displays.waxName.textContent = waxName;
        displays.meltInfo.textContent = meltMsg;
        displays.cureInfo.textContent = cureMsg;
    }

    // --- PART 3: EVENT LISTENERS ---

dd.search.addEventListener('click', () => {
        // If the menu is hidden, show it!
        if (dd.list.classList.contains('hidden')) {
            renderDropdown(dd.search.value); // Render current results
            dd.list.classList.remove('hidden'); // Show the list
            
            // If the box isn't empty, ensure the icon shows 'X'
            if (dd.search.value !== '') {
                setDropdownIcon('close');
            }
        }
    });

    // Dropdown Interactions
    dd.search.addEventListener('input', (e) => {
        if (e.target.value === '') {
            setDropdownIcon('open');
        }
        renderDropdown(e.target.value);
        dd.list.classList.remove('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!dd.container.contains(e.target)) {
            dd.list.classList.add('hidden');
        }
    });

    // Calculator Inputs (Recalculate on any change)
    const inputElements = [refs.waterWeight, refs.candleCount, refs.foSlider, refs.customSg];
    inputElements.forEach(el => {
        el.addEventListener('input', calculate);
        el.addEventListener('change', calculate);
    });

    // Global Unit Switch Listener (from scripts.js)
    document.addEventListener('unitChange', function(e) {
        if (e.detail.converting) {
            if(window.convertInput) convertInput('waterWeight', 'mass');
        }
        calculate();
    });

   // --- STARTUP ---
    
    // Check if we need initial unit conversion (if page loads in Metric mode)
    if(typeof globalUnit !== 'undefined' && globalUnit === 'metric' && refs.waterWeight.value) {
        if(window.convertInput) convertInput('waterWeight', 'mass');
    }

    // FIX: Do NOT auto-select a wax. 
    // Just run calculate() once to zero out the numbers.
    // The dropdown input will remain empty (showing the placeholder).
    calculate();

    // Initial check for metric mode
    if(typeof globalUnit !== 'undefined' && globalUnit === 'metric' && refs.waterWeight.value) {
        if(window.convertInput) convertInput('waterWeight', 'mass');
    }
</script>

<script src="footer.js"></script>



</body>





</html>